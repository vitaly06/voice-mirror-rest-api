# üé≠ Avatar & Wav2Lip Integration

## –û–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

VoiceMirror —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≤–∞—Ç–∞—Ä–æ–≤ —Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –≥—É–± —á–µ—Ä–µ–∑ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—é Wav2Lip.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üì∏ –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞

- –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ —Ñ–æ—Ç–æ –ª–∏—Ü–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ñ–æ—Ä–º–∞—Ç–æ–≤: JPG, PNG
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### üé¨ –ê–Ω–∏–º–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∞

- –°–∏–Ω—Ç–µ–∑ —Ä–µ—á–∏ —Å –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –≥–æ–ª–æ—Å–æ–º
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–∏–¥–µ–æ —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≥—É–±–∞–º–∏
- –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –≥—É–± —Å —Ä–µ—á—å—é

### üìä –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞

- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ò—Å—Ç–æ—Ä–∏—è –≤—Å–µ—Ö –∞–Ω–∏–º–∞—Ü–∏–π –∞–≤–∞—Ç–∞—Ä–∞

## üöÄ API Endpoints

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∞–≤–∞—Ç–∞—Ä–∞

```
POST /avatar/upload
Content-Type: multipart/form-data

Form fields:
- image: —Ñ–∞–π–ª –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (JPG/PNG, –¥–æ 5MB)
- name: –Ω–∞–∑–≤–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞
- description: –æ–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": 1,
  "name": "–ú–æ–π –∞–≤–∞—Ç–∞—Ä",
  "imageUrl": "http://localhost:3000/uploads/avatar-1234567890.jpg",
  "message": "–ê–≤–∞—Ç–∞—Ä —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω"
}
```

### 2. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–≤–∞—Ç–∞—Ä–æ–≤

```
GET /avatar
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
[
  {
    "id": 1,
    "name": "–ú–æ–π –∞–≤–∞—Ç–∞—Ä",
    "imageUrl": "http://localhost:3000/uploads/avatar-1234567890.jpg",
    "description": "–û–ø–∏—Å–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞",
    "createdAt": "2024-01-01T00:00:00Z",
    "updatedAt": "2024-01-01T00:00:00Z"
  }
]
```

### 3. –ê–Ω–∏–º–∏—Ä–æ–≤–∞—Ç—å –∞–≤–∞—Ç–∞—Ä

```
POST /avatar/animate
Content-Type: application/json

{
  "avatarId": 1,
  "text": "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –í–∏–∫—Ç–æ—Ä.",
  "voiceId": "voice_id_123456"  // –ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
}
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": 1,
  "avatarId": 1,
  "audioUrl": "http://localhost:3000/uploads/speech-1234567890.mp3",
  "videoUrl": "", // –ó–∞–ø–æ–ª–Ω–∏—Ç—Å—è –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏
  "text": "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –í–∏–∫—Ç–æ—Ä.",
  "status": "processing",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∞–Ω–∏–º–∞—Ü–∏–∏

```
GET /avatar/animations/{id}/status
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞:**

```json
{
  "id": 1,
  "avatarId": 1,
  "audioUrl": "http://localhost:3000/uploads/speech-1234567890.mp3",
  "videoUrl": "http://localhost:3000/uploads/animated-1234567890.mp4",
  "text": "–ü—Ä–∏–≤–µ—Ç! –ú–µ–Ω—è –∑–æ–≤—É—Ç –í–∏–∫—Ç–æ—Ä.",
  "status": "completed",
  "createdAt": "2024-01-01T00:00:00Z"
}
```

### 5. –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –∞–≤–∞—Ç–∞—Ä–∞

```
GET /avatar/{avatarId}/animations
```

## üõ†Ô∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Wav2Lip

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. **–°–∫–∞—á–∞–π—Ç–µ –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å:**

```bash
cd wav2lip/checkpoints
wget "https://iiitaphyd-my.sharepoint.com/:u:/g/personal/radrabha_m_research_iiit_ac_in/Eb3LEzbfuKlJiR600lQWRxgBIY27JZdBBREYI_Gbb6h6Kw" -O wav2lip_gan.pth
```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**

```bash
pip install numpy opencv-python librosa scipy tqdm numba
```

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ FFmpeg:**

```bash
# Windows (Chocolatey)
choco install ffmpeg

# macOS (Homebrew)
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg
```

4. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:**

```bash
# –í .env —Ñ–∞–π–ª–µ
WAV2LIP_PATH="./wav2lip"
```

### Docker —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

Docker –æ–±—Ä–∞–∑ —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

- Python 3 + pip
- FFmpeg
- OpenCV
- NumPy, SciPy, Librosa

```bash
# –°–±–æ—Ä–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Wav2Lip
docker-compose up --build
```

## üìã Workflow –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞

```javascript
// –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∞–≤–∞—Ç–∞—Ä–∞
const formData = new FormData();
formData.append('image', avatarPhoto);
formData.append('name', '–ú–æ–π –∞–≤–∞—Ç–∞—Ä');
formData.append('description', '–û–ø–∏—Å–∞–Ω–∏–µ');

const avatar = await fetch('/avatar/upload', {
  method: 'POST',
  body: formData,
}).then((r) => r.json());

console.log('–ê–≤–∞—Ç–∞—Ä —Å–æ–∑–¥–∞–Ω:', avatar);
```

### 2. –ê–Ω–∏–º–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∞

```javascript
// –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏
const animation = await fetch('/avatar/animate', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    avatarId: 1,
    text: '–ü—Ä–∏–≤–µ—Ç! –ö–∞–∫ –¥–µ–ª–∞?',
    voiceId: 'voice_id_123456', // –ò–∑ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤
  }),
}).then((r) => r.json());

// –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
const checkStatus = setInterval(async () => {
  const status = await fetch(`/avatar/animations/${animation.id}/status`).then(
    (r) => r.json(),
  );

  if (status.status === 'completed') {
    console.log('–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ:', status.videoUrl);

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
    const video = document.createElement('video');
    video.src = status.videoUrl;
    video.controls = true;
    document.body.appendChild(video);

    clearInterval(checkStatus);
  } else if (status.status === 'error') {
    console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏');
    clearInterval(checkStatus);
  }
}, 2000);
```

### 3. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≤–∞—Ç–∞—Ä–∞–º–∏

```javascript
// –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–≤–∞—Ç–∞—Ä—ã
const avatars = await fetch('/avatar').then((r) => r.json());

// –ü–æ–ª—É—á–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
const animations = await fetch(`/avatar/${avatarId}/animations`).then((r) =>
  r.json(),
);
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤

- **–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**: JPG, PNG –¥–æ 5MB
- **–í–∏–¥–µ–æ**: MP4 —Ñ–æ—Ä–º–∞—Ç –Ω–∞ –≤—ã—Ö–æ–¥–µ
- **–†–∞–∑—Ä–µ—à–µ–Ω–∏–µ**: 512x512 –ø–∏–∫—Å–µ–ª–µ–π (–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è)

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏: 30-60 —Å–µ–∫—É–Ω–¥ –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ —Ä–µ—á–∏
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è (–≤ Docker)
- –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç API

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

- –í–æ–∑–º–æ–∂–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –º–∞—Å—Å–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üö® –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è (Demo):

- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è FFmpeg –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ –≤–∏–¥–µ–æ
- –ù–∞—Å—Ç–æ—è—â–∏–π Wav2Lip —Ç—Ä–µ–±—É–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –±–µ–∑ GPU

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:

- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞—Å—Ç–æ—è—â—É—é –º–æ–¥–µ–ª—å Wav2Lip
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GPU –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

## üìö Swagger –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü–æ–ª–Ω–∞—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É:

```
http://localhost:3000/api
```

–í —Ä–∞–∑–¥–µ–ª–µ "üé≠ –ê–≤–∞—Ç–∞—Ä –∏ –∞–Ω–∏–º–∞—Ü–∏—è –ª–∏—Ü–∞" –≤—ã –Ω–∞–π–¥–µ—Ç–µ –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤.

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Wav2Lip —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](https://github.com/Rudrabha/Wav2Lip)
- [–ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å](https://iiitaphyd-my.sharepoint.com/:u:/g/personal/radrabha_m_research_iiit_ac_in/Eb3LEzbfuKlJiR600lQWRxgBIY27JZdBBREYI_Gbb6h6Kw)
- [FFmpeg –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://ffmpeg.org/documentation.html)
